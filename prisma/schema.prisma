// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
id String  @id @db.Uuid @default(uuid())
name String @db.VarChar(200)
email String @db.VarChar(200) @unique
username String @db.VarChar(200) @unique
password String @db.VarChar(15)
token String? @unique
following Follow[] @relation("user_following")
followers Follow[] @relation("user_followers")
tweets Tweet[]
reply ReTweet[]
@@map("user")
}

model Tweet {
  idTweet String @id @db.Uuid @default(uuid()) @map("id_Tweet")
  idUser String @db.Uuid @map("id_user")
  content String @db.VarBit()
  reply ReTweet[]
  likes Liker[]
  user User @relation(fields: [idUser], references: [id])
  @@map("tweet")
  @@unique([idTweet, idUser])
}

model Follow {
  id String @db.Uuid @default(uuid())
  idUserFollowing String @db.Uuid @map("id_user_Following")
  idUserFollower String @db.Uuid @map("id_user_Follower")
  following User @relation("user_following", fields: [idUserFollowing],references: [id])
  followers User @relation("user_followers",fields: [idUserFollower],references: [id])

  @@unique([idUserFollowing, idUserFollower], name: "follow_pkey")
  @@map("follows")
}

model ReTweet {
  idReTweet String @id @db.Uuid  @default(uuid()) @map("id_ReTweet")
  idUserReply String @db.Uuid @map("id_user_reply")
  idUserTweetOriginal String @db.Uuid @map("id_user_TweetOriginal")
  idTweetOriginal String @db.Uuid @map("id_TweetOriginal")
  contentReplay String @db.VarBit()
  likes Liker[]
  tweet Tweet @relation(fields: [idTweetOriginal, idUserTweetOriginal], references: [idTweet, idUser])
  user User @relation(fields: [idUserReply],references: [id])
  @@map("reTweet")
}

model Liker {
  idLike String @id @db.Uuid @default(uuid()) @map("id_like")
  idUser String @db.Uuid @map("id_user")
  idTweet String @db.Uuid @map("id_Tweet") 
  idReply String @db.Uuid
  tweet Tweet @relation(fields: [idTweet,idUser ],references: [idTweet, idUser])
  reTweet ReTweet @relation(fields: [idReply],references: [idReTweet])
  @@map("liker")
}
